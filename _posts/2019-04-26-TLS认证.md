---
layout: post
title: TLS认证
date: 2019-04-26
tags: k8s
---
* [TLS](#tls)
* [CA](#ca)
* [证书](#zhengshu)
* [认证过程](#renzhengguocheng)


### <a name="tls"></a>TLS
tls是安全传输协议，https使用tls来保证数据的完整性和保密性。
保密性是使用非对称加密的方式来实现的，通过使用公钥加密私钥解密的方式来完成的。
完整性通过证书签名来实现，签名需要使用的是权威认证机构的私钥加密公钥解密的方式完成的。

### <a name="ca"></a>CA
首先来看百度百科中关于CA的定义。
> 证书颁发机构（CA, Certificate Authority）即颁发数字证书的机构。 是负责发放和管理数字证书的权威机构，并作为电子商务交易中受信任的第三方，承担公钥体系中公钥的合法性检验的责任。

每一个CA机构都有自己的一个根证书和配对的私钥，当CA机构需要为一个用户签发证书时，首先对证书的信息通过摘要算法提取，然后对摘要信息进行加密，加密的时候使用的是ca机构根证书配对的私钥。并且该CA的自签名证书会保存在很多地方，从证书里面得到公钥就可以解析CA签发的证书，认证用户的身份信息。


### <a name="zhengshu"></a>证书
证书是TLS中的关键，常见的证书格式是X509,我们首先来分析这个证书格式。

<div align="center">
	<img src="/images/posts/tls/v2_hd.jpg" height="600" width="1000">  
</div> 
可见一个x509 证书中包含的信息主要有一下几点：
+ 证书的版本信息
+ 证书的序列号，每个证书都有一个唯一的证书序列号
+ 证书所使用的签名算法
+ 证书的发行机构名称，命名规则一般采用X.500格式
+ 证书的有效期，通用的证书一般采用UTC时间格式，它的计时范围为1950-2049
+ 证书所有人的名称 (Subject)，命名规则一般采用X.500格式
+ 证书所有人的公钥
+ 证书发行者 (Issuer) 对证书的签名
其中证书采用的签名算法只是为了在解析签名的时候选择合适的CA公钥。
当认证通过之后我们就有了证书所有人的公钥，通过这个公钥我们就可以和证书所有者进行加密通信了。

### <a name="renzhengguocheng"></a>认证过程

认证的详细过程如下所示：
<div align="center">
	<img src="/images/posts/tls/1658dd61a9f97e27" height="600" width="1000">  
</div> 

